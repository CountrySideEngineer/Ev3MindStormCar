/**
 *  CMD_Main.c
 *
 *  Command handling main source code.
 */
#include "ev3api.h"

/*****************************************************************************/
/*                                  変数定義                                 */
/*****************************************************************************/


/*****************************************************************************/
/*                                  静的変数                                 */
/*****************************************************************************/


/*****************************************************************************/
/*                                  定数定義                                 */
/*****************************************************************************/


/*****************************************************************************/
/*                                外部変数宣言                               */
/*****************************************************************************/
extern uint8_t rcv_msg_buf[];
extern uint8_t snd_msg_buf[];
extern uint8_t rcv_msg_len;
extern uint8_t snd_msg_len;

/*****************************************************************************/
/*                                外部定数定義                               */
/*****************************************************************************/


/*****************************************************************************/
/*                                  外部関数                                 */
/*****************************************************************************/
extern void cmd_code00(void);

/*****************************************************************************/
/*                                  関数実装                                 */
/*****************************************************************************/
static void cmd_invalid_code(void);

/**
 *  @brief  コマンド処理のメイン関数。
 *          受信データのコマンドコードを判定、対応する処理を呼び出す。
 */
void cmd_handle_main() {
    char cmd_code = 0;

    cmd_code = rcv_msg_buf[0];
    switch (cmd_code) {
    case 0x00: cmd_code00(); break;
    default: cmd_invalid_code(); break;
    }
}

/**
 *  @brief  対応していないコマンドコードを受信した場合の返信データを
 *          作成する。
 */
static void cmd_invalid_code(void) {
    snd_msg_buf[0] = 0xFF;
    snd_msg_buf[1] = 0x00;
    snd_msg_len = 2; 
}
